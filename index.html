<!DOCTYPE html>
<html>
<head>
    <title>Smile Score Live</title>
</head>
<body>
    <h1>Smile Score Live</h1>

    <video id="video" width="400" height="300" autoplay></video>
    <button id="captureBtn">Capture & Check Happiness</button>

    <h2 id="result"></h2>

    <canvas id="canvas" width="400" height="300" style="display:none;"></canvas>

    <script>
        const video = document.getElementById('video');
        const canvas = document.getElementById('canvas');
        const result = document.getElementById('result');
        const captureBtn = document.getElementById('captureBtn');

        // Access webcam
        navigator.mediaDevices.getUserMedia({ video: true })
            .then(stream => {
                video.srcObject = stream;
            })
            .catch(err => {
                console.error("Error accessing webcam:", err);
                alert("Cannot access webcam.");
            });

        captureBtn.addEventListener('click', async () => {
            // Draw current frame to canvas
            const context = canvas.getContext('2d');
            context.drawImage(video, 0, 0, canvas.width, canvas.height);

            // Convert canvas to Blob (image file)
            canvas.toBlob(async (blob) => {
                const formData = new FormData();
                formData.append('image', blob, 'capture.jpg');

                try {
    const response = await fetch('https://smile-score.onrender.com/predict_emotion/', {
        method: 'POST',
        body: formData
    });

    let data;
    try {
        data = await response.json();
    } catch {
        result.innerText = "Backend returned invalid JSON.";
        return;
    }

    if (response.ok && data.happiness_score) {
        result.innerText = data.happiness_score;
    } else {
        result.innerText = "Error: " + (data.error || "Unknown error");
    }
} catch (err) {
    result.innerText = "Error: " + err.message;
}


            }, 'image/jpeg');
        });
    </script>
</body>
</html>
